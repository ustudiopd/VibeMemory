# 챗봇 가독성 개선 검토 리포트

## 📋 현재 프로젝트 상태 분석

### ✅ 이미 구현된 기능
1. **SSE 스트리밍**: `@microsoft/fetch-event-source` 사용 중 ✅
2. **POST 방식 SSE**: 이미 구현됨 ✅
3. **세션/메시지 저장**: `chat_sessions`, `chat_messages` 테이블 활용 ✅
4. **출처 표시**: RAG 검색 결과의 파일 경로 표시 ✅
5. **프로젝트별 RAG**: `search_project_chunks_rrf` RPC 사용 ✅

### ❌ 개선이 필요한 부분
1. **마크다운 렌더링**: 현재 `whitespace-pre-wrap`로만 표시되어 가독성 저하
2. **마크다운 라이브러리**: `react-markdown` 등이 설치되지 않음
3. **Typography 플러그인**: `@tailwindcss/typography` 미설치
4. **코드 하이라이트**: 코드블록이 일반 텍스트로 표시됨

---

## 🔍 해결책.md 검토 결과

### ✅ 장점 및 적합성

1. **현재 스택과 완벽 호환**
   - Next.js 16 + Tailwind CSS 4 + TypeScript 환경에 적합
   - 이미 `fetchEventSource` 사용 중이므로 추가 학습 곡선 없음
   - Supabase + Vercel AI SDK와 충돌 없음

2. **실용적인 패키지 선택**
   - `react-markdown`: 안정적이고 널리 사용되는 마크다운 렌더러
   - `remark-gfm`: GitHub Flavored Markdown 지원 (표, 체크박스 등)
   - `remark-breaks`: 한 줄 개행 처리 (채팅에 적합)
   - `rehype-sanitize`: XSS 방지 (보안 필수)
   - `rehype-prism-plus`: 코드 하이라이트

3. **현재 코드 구조와 잘 맞음**
   - `ChatInterface.tsx`에 쉽게 통합 가능
   - 기존 `formatMarkdown` 함수(`page.tsx`)와 병행 사용 가능
   - 출처 표시 기능과 자연스럽게 결합 가능

### ⚠️ 주의사항 및 수정 필요 사항

1. **패키지 버전 호환성**
   - `rehype-prism-plus` 대신 `rehype-highlight` 또는 `rehype-pretty-code` 고려
   - Tailwind CSS 4에서는 Typography 플러그인 설정 방식이 다를 수 있음

2. **스트리밍 최적화**
   - 해결책.md의 코드블록 버퍼링 로직은 좋지만, 현재 구현과 통합 필요
   - 리렌더링 최적화를 위한 `useMemo` 또는 `React.memo` 고려

3. **한글 래핑**
   - `.kor-wrap` 클래스가 `globals.css`에 없으므로 추가 필요
   - 또는 기존 Tailwind 유틸리티 클래스 활용

4. **현재 구현과의 차이점**
   - 해결책.md는 단순한 `useChatStream` 훅을 제안하지만, 현재는 세션 관리가 포함된 복잡한 구조
   - 기존 세션 관리 로직을 유지하면서 마크다운 렌더링만 추가하는 것이 좋음

---

## 📦 필요한 패키지 설치

```bash
npm i react-markdown remark-gfm remark-breaks rehype-raw rehype-sanitize rehype-highlight @tailwindcss/typography
```

**대안 (더 현대적인 선택):**
```bash
npm i react-markdown remark-gfm remark-breaks rehype-raw rehype-sanitize rehype-pretty-code @tailwindcss/typography
```

> **참고**: `rehype-prism-plus`는 유지보수가 적어 `rehype-highlight` 또는 `rehype-pretty-code`를 권장합니다.

---

## 🎯 적용 계획

### Phase 1: 기본 마크다운 렌더링 (필수)
1. 패키지 설치
2. `ChatMarkdown` 컴포넌트 생성
3. `ChatInterface.tsx`에서 `whitespace-pre-wrap` → `ChatMarkdown` 교체
4. Tailwind Typography 플러그인 설정
5. `globals.css`에 한글 래핑 스타일 추가

### Phase 2: 코드 하이라이트 (권장)
1. `rehype-highlight` 또는 `rehype-pretty-code` 설정
2. 코드블록 스타일링
3. (선택) 코드블록 복사 버튼 추가

### Phase 3: UX 개선 (선택)
1. 긴 답변 접기/펼치기
2. 링크 새 창 열기 (이미 해결책.md에 포함)
3. 표 스타일링 개선
4. 출처 칩 스타일 개선

---

## 🔧 구체적인 수정 사항

### 1. `tailwind.config.ts`
```ts
import type { Config } from "tailwindcss";
import typography from '@tailwindcss/typography'; // 추가

const config: Config = {
  content: [
    "./pages/**/*.{js,ts,jsx,tsx,mdx}",
    "./components/**/*.{js,ts,jsx,tsx,mdx}",
    "./app/**/*.{js,ts,jsx,tsx,mdx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [typography], // 추가
};
export default config;
```

### 2. `app/globals.css`
```css
@import "tailwindcss";

/* 한글 문단 가독성 */
.kor-wrap {
  word-break: keep-all;
  line-height: 1.75;
}

/* 코드블록이 화면 밖으로 넘치지 않게 */
.prose pre {
  white-space: pre-wrap;
  word-break: break-word;
  overflow-x: auto;
}

.prose code {
  word-wrap: break-word;
}
```

### 3. `components/ChatMarkdown.tsx` (신규 생성)
- 해결책.md의 예시를 기반으로 생성
- 현재 프로젝트 스타일(slate 색상)에 맞게 조정
- 출처 표시와 자연스럽게 결합되도록 설계

### 4. `components/ChatInterface.tsx` 수정
- `message.content`를 `ChatMarkdown` 컴포넌트로 렌더링
- 스트리밍 중인 메시지도 마크다운 렌더링 적용
- 기존 세션 관리 로직 유지

---

## ⚡ 성능 고려사항

1. **스트리밍 중 리렌더링 최적화**
   - 코드블록 버퍼링 로직 적용 (해결책.md 참조)
   - `React.memo`로 `ChatMarkdown` 컴포넌트 최적화

2. **번들 크기**
   - `react-markdown`은 약 50KB (gzipped)
   - 코드 하이라이트 라이브러리는 추가 20-30KB
   - 필요시 동적 임포트 고려

---

## ✅ 검증 체크리스트

- [ ] 마크다운 제목(#, ##, ###)이 올바르게 렌더링되는가?
- [ ] 리스트(-, 1. 2. 3.)가 올바르게 표시되는가?
- [ ] 코드블록(```)이 하이라이트와 함께 표시되는가?
- [ ] 링크가 새 창에서 열리는가?
- [ ] 표가 올바르게 렌더링되는가?
- [ ] 스트리밍 중에도 마크다운이 실시간으로 렌더링되는가?
- [ ] 한글 텍스트가 자연스럽게 줄바꿈되는가?
- [ ] 출처 표시가 마크다운과 자연스럽게 결합되는가?

---

## 🎨 예상 결과

### Before (현재)
```
# 프로젝트 개요
EventLive.ai는 B2B2C 멀티테넌시 구조의...
- 주요 기능
- 실시간 채팅
```

### After (개선 후)
- 제목이 크고 굵게 표시
- 리스트가 들여쓰기와 불릿 포인트로 표시
- 코드블록이 하이라이트와 함께 표시
- 링크가 클릭 가능하고 새 창에서 열림
- 표가 깔끔하게 정렬되어 표시
- 전체적으로 ChatGPT 수준의 가독성

---

## 📝 결론

**해결책.md는 현재 프로젝트에 매우 적합하며, 즉시 적용 가능합니다.**

### 우선순위
1. **높음**: Phase 1 (기본 마크다운 렌더링) - 가독성 향상에 필수
2. **중간**: Phase 2 (코드 하이라이트) - 기술 문서 챗봇에 중요
3. **낮음**: Phase 3 (UX 개선) - 사용자 경험 향상

### 예상 작업 시간
- Phase 1: 30-60분
- Phase 2: 20-30분
- Phase 3: 30-60분

### 권장 사항
1. 먼저 Phase 1만 적용하여 기본 가독성 개선
2. 사용자 피드백 수집 후 Phase 2, 3 순차 적용
3. 코드 하이라이트는 `rehype-pretty-code` 권장 (더 현대적이고 커스터마이징 용이)

---

**작성일**: 2025-01-15  
**검토자**: AI Assistant  
**상태**: ✅ 적용 준비 완료

